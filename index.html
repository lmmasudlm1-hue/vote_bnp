<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BNP Photo Frame Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #28a745; --secondary: #dc3545; --bg: #f4f7f6; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Hind Siliguri', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 10px; }
        
        .container { background: #fff; width: 100%; max-width: 400px; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        .header { text-align: center; margin-bottom: 10px; }
        .header h2 { color: var(--secondary); font-size: 18px; margin-bottom: 3px; }
        .header p { font-size: 11px; color: #666; font-weight: 600; }

        /* ‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡¶∞ ‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡ßá‡¶∞ ‡¶â‡¶™‡¶∞‡ßá */
        .frame-section { margin-bottom: 10px; text-align: center; }
        .frame-label { font-size: 12px; font-weight: bold; margin-bottom: 5px; display: block; }
        .frame-selector { display: flex; gap: 10px; justify-content: center; }
        .frame-thumb { width: 50px; height: 50px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; overflow: hidden; transition: 0.3s; }
        .frame-thumb.active { border-color: var(--primary); transform: scale(1.1); box-shadow: 0 0 8px rgba(40,167,69,0.3); }
        .frame-thumb img { width: 100%; height: 100%; object-fit: cover; }

        .upload-box { border: 2px dashed var(--primary); padding: 10px; border-radius: 12px; text-align: center; cursor: pointer; background: #f8fff9; display: block; margin-bottom: 10px; }
        .upload-box span { color: var(--primary); font-weight: bold; font-size: 14px; }
        
        .canvas-area { width: 100%; aspect-ratio: 1/1; background: #eee; border-radius: 12px; overflow: hidden; border: 1px solid #ddd; position: relative; }
        
        /* ‡¶∏‡ßå‡¶ú‡¶®‡ßç‡¶Ø‡ßá ‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡ßá‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá */
        .soujonne-box { text-align: center; margin: 8px 0; }
        .soujonne { color: #0056b3; font-weight: bold; font-size: 15px; }

        .controls { display: flex; flex-direction: column; gap: 8px; background: #f9f9f9; padding: 12px; border-radius: 10px; margin-bottom: 15px; }
        .control-row { display: flex; align-items: center; gap: 10px; }
        .control-row label { font-size: 11px; width: 70px; font-weight: bold; }
        input[type="range"] { flex: 1; accent-color: var(--primary); }

        .btn-download { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 12px; font-weight: bold; font-size: 17px; cursor: pointer; width: 100%; transition: 0.3s; }
        .btn-download:hover { background: #218838; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>‡ßß‡ß® ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶∏‡¶æ‡¶∞‡¶æ ‡¶¶‡¶ø‡¶®, ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∑‡ßá ‡¶≠‡ßã‡¶ü ‡¶¶‡¶ø‡¶®</h2>
        <p>‡¶¨‡¶ø‡¶è‡¶®‡¶™‡¶ø‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ ‡¶è‡¶á ‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ì ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá‡¶®</p>
    </div>

    <div class="frame-section">
        <span class="frame-label">‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡¶ü‡¶ø ‡¶¨‡ßá‡¶õ‡ßá ‡¶®‡¶ø‡¶®:</span>
        <div class="frame-selector">
            <div class="frame-thumb active" onclick="changeFrame('frame2.png', this)">
                <img src="frame2.png" alt="Frame 2">
            </div>
            <div class="frame-thumb" onclick="changeFrame('image_d26985.png', this)">
                <img src="image_d26985.png" alt="Frame 1">
            </div>
        </div>
    </div>

    <label for="imgUpload" class="upload-box">
        <span>üì∑ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</span>
        <input type="file" id="imgUpload" accept="image/*">
    </label>

    <div class="canvas-area">
        <canvas id="canvas"></canvas>
    </div>

    <div class="soujonne-box">
        <span class="soujonne">‡¶∏‡ßå‡¶ú‡¶®‡ßç‡¶Ø‡ßá: ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶Ø‡¶º‡ßá‡¶∏ ‡¶ï‡¶æ‡¶∞‡¶®‡ßÄ</span>
    </div>

    <div class="controls">
        <div class="control-row"><label>üîç ‡¶ú‡ßÅ‡¶Æ</label><input type="range" id="zoom" min="0.1" max="3" step="0.01" value="1"></div>
        <div class="control-row"><label>‚ÜîÔ∏è ‡¶°‡¶æ‡¶®‡ßá-‡¶¨‡¶æ‡¶Æ‡ßá</label><input type="range" id="posX" min="-500" max="1000" step="1"></div>
        <div class="control-row"><label>‚ÜïÔ∏è ‡¶â‡¶™‡¶∞‡ßá-‡¶®‡¶ø‡¶ö‡ßá</label><input type="range" id="posY" min="-500" max="1000" step="1"></div>
    </div>

    <button class="btn-download" onclick="downloadImage()">‚¨áÔ∏è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
</div>

<script>
    const canvasArea = document.querySelector('.canvas-area');
    const side = canvasArea.offsetWidth;
    const canvas = new fabric.Canvas('canvas', { 
        width: side, 
        height: side, 
        preserveObjectStacking: true,
        selection: false // ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶®‡ßç‡¶ß
    });

    let userImage = null;
    let currentFrameImg = null;

    function loadFrame(url) {
        fabric.Image.fromURL(url, function(img) {
            if(currentFrameImg) canvas.remove(currentFrameImg);
            img.scaleToWidth(side);
            img.set({ selectable: false, evented: false });
            canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));
            currentFrameImg = img;
        }, { crossOrigin: 'anonymous' });
    }

    // Default Frame
    loadFrame('frame2.png');

    function changeFrame(url, element) {
        document.querySelectorAll('.frame-thumb').forEach(el => el.classList.remove('active'));
        element.classList.add('active');
        loadFrame(url);
    }

    document.getElementById('imgUpload').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function(f) {
            fabric.Image.fromURL(f.target.result, function(img) {
                if (userImage) canvas.remove(userImage);
                userImage = img;
                img.scaleToWidth(side * 0.8);
                img.set({ 
                    left: side/2, 
                    top: side/2, 
                    originX: 'center', 
                    originY: 'center',
                    cornerColor: 'white',
                    cornerStrokeColor: '#28a745',
                    transparentCorners: false,
                    cornerSize: 8
                });
                canvas.add(img);
                canvas.sendToBack(img);
                canvas.setActiveObject(img);
                updateSliders();
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    // ‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶ì‡¶™‡¶∞ ‡¶®‡¶æ‡ßú‡¶æ‡¶ö‡¶æ‡ßú‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶¨‡ßá
    canvas.on('object:moving', function() {
        updateSliders();
    });

    canvas.on('object:scaling', function() {
        updateSliders();
    });

    const z = document.getElementById('zoom'), x = document.getElementById('posX'), y = document.getElementById('posY');
    
    [z, x, y].forEach(el => el.oninput = () => {
        if(!userImage) return;
        if(el.id === 'zoom') userImage.scale(parseFloat(z.value));
        if(el.id === 'posX') userImage.set('left', parseFloat(x.value));
        if(el.id === 'posY') userImage.set('top', parseFloat(y.value));
        userImage.setCoords();
        canvas.renderAll();
    });

    function updateSliders() {
        if(!userImage) return;
        z.value = userImage.scaleX;
        x.value = userImage.left;
        y.value = userImage.top;
    }

    function downloadImage() {
        if(!userImage) return alert("‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®");
        canvas.discardActiveObject(); // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶¨‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶Æ‡ßÅ‡¶≠ ‡¶ï‡¶∞‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá
        canvas.renderAll();
        const link = document.createElement('a');
        link.download = 'bnp_election_photo.png';
        link.href = canvas.toDataURL({ format: 'png', multiplier: 2 });
        link.click();
    }
</script>
</body>
</html>
